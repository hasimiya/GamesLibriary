@model GamesLibriary.Models.ViewModel.GamesListViewModel
@using System.Text.Json
@using System.Text.Json.Serialization
@{
    ViewData["Title"] = "Home Page";
    var options = new JsonSerializerOptions
    {
        Converters = { new JsonStringEnumConverter() }
    };
}

<div class="text-center">
    <h1 class="display-4">Welcome to Hachhook</h1>
    <p>Learn about <a href="https://docs.microsoft.com/aspnet/core">building Web apps with ASP.NET Core</a>.</p>
    <div class="button-action" style="margin-bottom: 10px">
        <form asp-action="Create" method="get">
            <button type="submit" class="btn btn-info">Create new +</button>
        </form>
        <button type="button" class="btn btn-info" data-toggle="modal" data-target="#createModal" onclick="openCreateModal(this)">Crete new =</button>
        <a class="btn btn-info" href="?sortOrder=title__ascending@(Model.CurrentGenre != null ? $"&gamesGenre={Model.CurrentGenre}" : "")">↑</a>
        <a class="btn btn-info" href="?sortOrder=title__descending@(Model.CurrentGenre != null ? $"&gamesGenre={Model.CurrentGenre}" : "")">↓</a>
        <form method="get">
            <select name="gamesGenre" class="btn btn-info">
                <option value="">All</option>
                @foreach (var value in Enum.GetValues(typeof(GamesItem.GameGenre)))
                {
                    <option value="@value" selected="@(Model.CurrentGenre?.ToString() == value.ToString() ? "selected" : null)">
                        @value
                    </option>
                }
            </select>
            <button type="submit" class="btn btn-info">Filter</button>
        </form>
    </div>
    @foreach (var games in Model.gamesItems)
    {
        <div class="wrapper-block-games">
            <div class="images">
                <img src="@Url.Content(games.ImageUrl)" />
            </div>
            <div class="description">
                <h2>@games.Name</h2>
                <h6>@games.Description</h6>
                <div style="display: flex; justify-content: space-between">
                    <div>
                        <h6>Жанр: @games.Genre</h6>
                        <h6>Год выпуска: @games.Publication</h6>
                    </div>
                    <div class="button-action">
                        <form asp-action="Edit" method="get">
                            <input type="hidden" name="id" value="@games.ID" />
                            <button type="submit" class="btn btn-outline-primary">Edit</button>
                        </form>

                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#editModal" onclick="openEditModal(this)"
                                data-game='@Html.Raw(JsonSerializer.Serialize(games, options))'>Edit</button>

                        <button type="button" class="btn btn-outline-danger" data-toggle="modal" data-target="#deleteModal"
                                data-game-id="@games.ID" data-game-name="@games.Name" onclick="openDeleteModal(this)">
                            @* data-toggle - используеться для открытия модального окна
                                data-target - указываем на ID модального окна
                                data-game-id - передаем ID игры для удаления
                                data-game-name - передаем название игры для отображения в модальном окне
                                onclick - вызываем функцию openDeleteModal, которая заполняет модальное окно данными*@
                            Delete
                        </button>
                    </div>
                </div>
            </div>
        </div>
    }
    <div>
        @for (int i = 1; i <= Model.TotalPages; i++)
        {
            <a class="btn btn-info" asp-action="Index" asp-route-page="@i"
               asp-route-sortOrder-="@Context.Request.Query["sortOrder"]" asp-route-gamesGenre="@(Model.CurrentGenre?.ToString())">@i</a>
        }
    </div>
</div>

@await Html.PartialAsync("_DeleteModalPartial")
@await Html.PartialAsync("_EditModalPartial")
@await Html.PartialAsync("_CreateModalPartial")

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
} 